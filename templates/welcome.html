{% extends "base.html" %}

{% block title %}Tableau de Bord - {{ club.name }}{% endblock %}

{% block content %}
<main class="container page-transition">
    <main class="container page-transition">

    {# --- BLOC √Ä AJOUTER --- #}
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="flash-error" style="background: rgba(0,255,127,0.1); color: var(--status-available); border-color: rgba(0,255,127,0.2); margin-bottom: 2rem;">
            {% for message in messages %}
                <p>{{ message }}</p>
            {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    {# --- FIN DU BLOC --- #}

    <section class="fade-in" style="text-align: center; margin: 3rem 0;">

    <section class="fade-in" style="text-align: center; margin: 3rem 0;">
        <h1 style="font-size: 3rem; font-weight: 800; margin-bottom: 1rem; background: linear-gradient(135deg, var(--text-primary), var(--color-primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            Bienvenue, <span style="color: var(--color-primary);">{{ club.name }}</span>
        </h1>
        <p style="font-size: 1.2rem; color: var(--text-secondary); max-width: 600px; margin: 0 auto;">
            G√©rez vos inscriptions et suivez vos performances depuis votre tableau de bord.
        </p>
    </section>

    <section class="dashboard-grid slide-up">
        <div class="stats-card slide-up-delay-1">
            <div class="stats-label">Points Disponibles</div>
            <div class="stats-number">{{ club.points }}</div>
            <div class="stats-desc">Points accumul√©s par votre club.</div>
        </div>
        
        <div class="stats-card slide-up-delay-2">
            <div class="stats-label">Athl√®tes Inscrits</div>
            <div class="stats-number">{{ total_places_booked }}</div>
            <div class="stats-desc">Total des places r√©serv√©es par votre club.</div>
        </div>
    </section>

    <section class="slide-up-delay-3" style="margin: 3rem 0;">
        <div class="card">
            <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 2rem;">üéØ Actions Rapides</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                
                <a href="#competitions" class="card" style="text-decoration: none; padding: 1.5rem; background: rgba(0,255,127,0.05); border: 1px solid rgba(0,255,127,0.2);">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">üèÜ</div>
                    <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.5rem;">R√©server des Places</h3>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Voir la liste des comp√©titions et inscrire des athl√®tes.</p>
                </a>
                
                <a href="{{ url_for('points_board') }}" class="card" style="text-decoration: none; padding: 1.5rem; background: rgba(255,193,7,0.05); border: 1px solid rgba(255,193,7,0.2);">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">üèÖ</div>
                    <h3 style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.5rem;">Voir le Classement</h3>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Consulter le tableau public des points de tous les clubs.</p>
                </a>

            </div>
        </div>
    </section>

<section class="slide-up-delay-3" style="margin: 3rem 0;">
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h2 style="font-size: 2rem; font-weight: 700;">üìÖ Prochaines Comp√©titions</h2>
            <a href="{{ url_for('points_board') }}" class="btn-secondary">Voir le classement ‚Üí</a>
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            {% for comp in competitions if not comp.is_past %}
                <div class="card" style="background: rgba(255,255,255,0.02);">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;">
                        
                        <div>
                            <h3 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">{{ comp.name }}</h3>
                            <div style="display: flex; gap: 1rem; font-size: 0.9rem; color: var(--text-secondary);">
                                <span>üìÖ {{ comp.date }}</span>
                                <span>üìç {{ comp.get('numberOfPlaces', 0) }} places restantes</span>
                            </div>
                        </div>

                        <div> {# Ce div conteneur isole la zone cliquable #}
                            {% set places_booked_by_club = comp.placesBookedByClub.get(club.name, 0) if comp.placesBookedByClub else 0 %}
                            
                            {% if comp.get('numberOfPlaces')|int == 0 %}
                                <div class="status status-full">Compl√®te</div>
                            {% elif places_booked_by_club >= 12 %}
                                <div class="status status-almost">Quota atteint</div>
                            {% else %}
                                <a href="{{ url_for('book',competition=comp['name'],club=club['name']) }}" class="btn" style="padding: 0.75rem 1.5rem;">R√©server</a>
                            {% endif %}
                        </div>
                        
                    </div>
                </div>
            {% else %}
                <p style="color: var(--text-secondary); text-align: center; padding: 2rem;">Aucune comp√©tition √† venir pour le moment.</p>
            {% endfor %}
        </div>
    </div>
</section>
</main>
{% endblock %}